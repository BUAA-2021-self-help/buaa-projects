# 总结

## 第一章 绪论

### 主要内容

- 本章通过对编译原理课程的介绍，引出了编译程序的概念，着重讨论了**编译程序与解释程序的区别**，揭示了**编译程序在计算机运行时的地位和作用**；
- 通过本章的学习，对编译程序的词法分析、语法分析、语义分析和中间代码生成、代码优化、目标代码生成、错误检查和处理、符号表管理等**七个**部分的功能和作用有一定的了解；
- 了解编译程序**前端**、**后端**，执行“遍”概念。

### 学习要求

- 编译程序的概念、编译程序与解释程序的区别，明确编译程序的七个组成部分；
- 了解七个组成部分的功能和作用。了解遍、前端和后端等概念。

### 重点、难点

- 重点掌握编译程序的概念和编程程序的七个组成部分。

![图片](https://uploader.shimo.im/f/lnix8yUbuQjRASAQ.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

（8 个逻辑部分：将生成中间代码也拆出来了）

### 编译程序

- 编译程序与解释程序的区别：是否生成中间代码
- 编译程序：若源程序是用高级语言书写，经加工后得到目标程序，上述翻译过程称“编译”

### 前端、后端

- 前端：通常将与源程序有关的编译部分称为前端。
  - 词法分析、语法分析、语义分析、中间代码生成、代码优化（分析部分）
  - 特点：与源语言有关
- 后端：与目标机有关的部分称为后端。
  - 目标程序生成（与目标机有关的优化）（综合部分）
  - 特点：与目标机有关

### 遍

- 遍：对源程序（包括源程序中间形式）从头到尾扫描一次，并做有关的加工处理，生成新的源程序中间形式或目标程序，通常称之为一遍。

## 第二章 文法和语言

### 主要内容

- 本章介绍了字母表、符号串和符号串集等概念，并介绍了求符号串的子串、长度、连接、方幂和字符串集的和、积、闭包的运算；通过文法推导的例子，引出了**文法**、**语言**、**BNF 范式**、**推导**、**归约**的概念，说明了**文法和语言的关系**，介绍了**规范推导**、**规范归约**；
- 通过递归的概念，介绍了**递归文法**的定义；
- 通过树的概念，引出了**语法树**、**子树**、**短语**、**简单短语**、**句柄**、**二义性**的概念，并介绍了通过语法树求短语、句柄、简单短语，**文法二义性**的算法，通过推导和归约的方法求出语法树的方法；
- 本章最后介绍了**文法的乔姆斯基分类**。

### 学习要求

- 了解**字母表**、**符号串**、**符号串集**、**递归**、**BNF 范式**、**推导**、**归约**、**句子**、**句型**等概念，了解符号串的前缀、后缀、**子串**、**长度**、**连接**、**方幂**和字符串集的**和**、**积**、**闭包**的求法；掌握**文法**、**语言**的定义；理解**文法和语言的关系**；理解什么是**规范推导**、**规范归约**；掌握**规范推导、规范归约的算法**，并能够求出对应的语法树；熟练掌握**根据语法树求短语、简单短语、句柄**的算法；
- 通过给定文法，掌握**求文法二义性**的方法；
- 了解**文法的分类**，并重点掌握 2 型文法和 3 型文法的定义。

### 文法、语言

文法 G=(Vn, Vt, P, Z)

- Vn：非终结符号集
- Vt：终结符号集
- P：产生式或规则的集合
- Z：开始符号（识别符号） Z∈Vn

规则是一个有序对(U, x), 通常写为：U ::= x 或 U -> x。其中|U| = 1 |x| >= 0

![图片](https://uploader.shimo.im/f/uAlBfGAti4y3Z5Vm.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

### （扩充的）BNF 范式

[Backus–Naur form - Wikipedia](https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form)

[Extended Backus–Naur form - Wikipedia](https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form)

| Usage                                                                               | Notation  |
| :---------------------------------------------------------------------------------- | :-------: |
| definition                                                                          |     =     |
| [concatenation](https://en.wikipedia.org/wiki/Concatenation)                        |     ,     |
| termination                                                                         |     ;     |
| [alternation](<https://en.wikipedia.org/wiki/Alternation_(formal_language_theory)>) |    \|     |
| optional                                                                            |  [ ... ]  |
| repetition                                                                          |  { ... }  |
| grouping                                                                            |  ( ... )  |
| terminal string                                                                     |  " ... "  |
| terminal string                                                                     |  ' ... '  |
| comment                                                                             | (_ ... _) |
| special sequence                                                                    |  ? ... ?  |
| exception                                                                           |     -     |

### 推导、归约

![图片](https://uploader.shimo.im/f/rIohICZmUPe25b1p.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/q7nPSuO4NabTTtZv.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/j8EqfigGKTeJsyyW.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

直观意义：**规范推导＝最右推导**

最右推导：若符号串中有两个以上的非终结符时，先推右边的。

最左推导：若符号串中有两个以上的非终结符时，先推左边的。

自下而上地修建子树的末端结点，直至把整棵树剪掉（留根），每剪一次对应一次规约。

从句型开始，**自左向右**地逐步进行规**约**，建立推导序列。

对句型中最左简单短语（句柄）进行的规约称为**规范归约**。

### 递归文法

![图片](https://uploader.shimo.im/f/U7HaSZg0t4xcCh3M.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

**左**递归文法的缺点：不能用**自顶向下**的方法来进行语法分析（需要转化为右递归）

递归文法的优点：可用有穷条规则，定义无穷语言

### 短语、简单短语、句柄、素短语

![图片](https://uploader.shimo.im/f/aKJDF7APUPFeXBnZ.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

[求短语，直接短语，句柄，素短语，最左素短语 - 例题解析](https://www.cnblogs.com/xpwi/p/11066989.html)

| 名称       | 概念                                                                                                                                                                                                                                                               |
| :--------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 短语       | **定义：**若 S 为文法 G 的开始符号，αβδ 是该文法的一个句型，即 S ⇒\* αβδ，且有 A ⇒+ β，则称 β 是句型 αβδ 相对于非终结符 A 的短语。**语法树：**在语法树中表示所有分支结点对应子树，短语即子树叶子对应的符号。**注：**子树包括语法树本身，及句型本身也可以称为短语。 |
| 直接短语   | **定义：**若 S ⇒\* αβδ，且文法中包含产生式 A → β，则称 β 是句型 αβδ 相对于非终结符 A 的直接短语。**语法树：**在语法树中表示为该短语只有上下相邻父子两代                                                                                                            |
| 句柄       | “可归约串”，句柄对应某个产生式的右部，是某个，但不是任意一个。作为一种归约对象，**句柄表示最左直接短语**。**语法树：**在语法树上，则表示为最左边的只包含相邻父子节点的短语（最左直接短语）                                                                         |
| 素短语     | **定义：**是指一个短语至少包含一个终结符，并且除它自身之外不再包含其他素短语                                                                                                                                                                                       |
| 最左素短语 | **定义：**最左素短语就是句型最左边的素短语，是算符优先分析法的归约对象。**语法树：**通过语法树分析时，要注意先判断是否为素短语，再找相对最左端的素短语。                                                                                                           |

### 二义性文法

若对于一个文法的某一句子存在两棵不同的语法树，则该文法是二义性文法，否则是无二义性文法。

判断二义性文法的算法：

- 假设文法的一个句子，如果对此句子的推导存在两棵不同的语法树，则为二义性文法。
- 假设文法的一个句子，如果对此句子存在两个不同的规范推导过程（最左推导亦然），则为二义性文法。
- 假设文法的一个句子，如果对此句子的某个规范句型存在两个不同的句柄，则为二义性文法。

### 文法的分类

- 0 型

![图片](https://uploader.shimo.im/f/sQtofg1yPzGLvEsa.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

- 1 型

![图片](https://uploader.shimo.im/f/esfdLG5EpbjCQUIm.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

- 2 型

![图片](https://uploader.shimo.im/f/uSMUzAFenN3rhtAz.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

- 3 型

![图片](https://uploader.shimo.im/f/2y08H6OsxWK0D0vw.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

- 关系

L3⊂L2⊂L1⊂L0

| 文法 | 文法                   | 自动机         | 产生式规则            |
| :--- | :--------------------- | :------------- | :-------------------- |
| 0-型 | 短语结构文法           | 图灵机         | α -> β（无限制）      |
| 1-型 | 上下文有关（敏感）文法 | 线性界限自动机 | α*A*β -> αγβ          |
| 2-型 | 上下文无关文法         | 下推自动机     | _A_-> γ               |
| 3-型 | 正则文法               | 有穷自动机     | _A_->_aB_<br>_A_->_a_ |

- 判断方法

![图片](https://uploader.shimo.im/f/mbdUNIfNgzecYvwl.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

特例：A->ε

## 第三章 词法分析

### 主要内容

- 本章通过对词法分析器的介绍，说明了词法分析器的作用，**词法分析器的输入和输出**、以及词法分析阶段的必要性；
- 介绍了**单词符号的内部表示**，通过**状态转换图**的介绍，引入了如何**由正则文法构造状态转换图，然后由状态转换图直接写词法分析程序的手工方法**；
- 介绍了**确定的有限自动机（DFA）**、**非确定有限自动机（NFA）**。并说明了**自动机**、**正则文法**和**正则表达式**的等价关系与转换方法，**NFA 的确定化**和**DFA 的最小化**。
- 通过词法分析程序，介绍了 lex 程序的输入、输出和程序本身的构造。

### 学习要求

- 了解词法分析器的作用和词法分析阶段的必要性，单词符号的内部表示，了解状态转换图、状态转换矩阵、正则式、正则集、LEX 的概念；理解确定的有限自动机、非确定的有限自动机和语言之间的联系；掌握词法分析器的输入和输出、LEX 程序的输入、输出和基本构造；熟练应用正则文法、正则表达式、有限自动机相互转换的算法。

### 重点、难点

- 正则文法、正则表达式、有限自动机相互转换的算法：正则文法->状态转换图，正则文法->正则式；
- 状态转换图可表示为有限自动机，然后非确定的有限自动机->确定的有限自动机（状态转换图）；
- 正则式->有限自动机（状态转换图）；
- NFA 的确定化（子集法）和最小化（分割法）。

### 词法分析程序

词法分析程序的功能：

- 词法分析：根据词法规则识别及组合单词，进行词法检查。
- 对数字常数完成数字字符串到（二进制）数值的转换。
- 删去空格字符和注解。

### 单词

单词的种类：

- 保留字：begin、end、for、do…
- 标识符：
- 常数：无符号数、布尔常数、字符串常数等
- 分界符：+、-、\*、/

输出形式：单词的内部形式（单词类别+单词值）

（标识符和常量要进符号表。生成目标代码时，常量写死在代码里）

### 左线性文法状态图

![图片](https://uploader.shimo.im/f/7sm1JulyMVoEKP7j.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

### 正则表达式

正则表达式的性质：

设 e1, e2 和 e3 均是某字母表上的正则表达式, 则有:

- 单位正则表达式: ε，εe = eε = e
- 交换律: e1|e2 = e2|e1
- 结合律: e1|(e2|e3) = (e1|e2)|e3；e1(e2e3) = (e1e2)e3
- 分配律: e1(e2|e3) = e1e2|e1e3；(e1|e2)e3 = e1e3|e2e3
- 此外: r* = (r|ε)*；r\*_ = r_；(r|s)* = (r*s*)*

正则表达式与 3 型文法等价

### 确定有穷自动机 DFA

![图片](https://uploader.shimo.im/f/A8RY05ve2SV7zXQf.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

所谓确定的状态机，其确定性表现在状态转移函数是单值函数

DFA M 所接受的语言为：L(M)={α|δ( s0, α)= sn, sn∈Z}

### 非确定的有穷自动机(NFA)

![图片](https://uploader.shimo.im/f/5JPgc78ktAVnHAU6.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

NFA M’所接受的语言为：L(M') = {α | δ(S0, α) = S' S'∩Z≠Φ}

### NFA 的确定化

> 子集法

### DFA 的最小化

> 分割法：把一个 DFA（不含多余状态）的状态分割成一些不相关的子集，使得任何不同的两个子集状态都是可区别的，而同一个子集中的任何状态都是等价的。

- 有穷自动机的多余状态：从该自动机的开始状态出发, 任何输入串也不能到达那个状态。
- 等价状态 状态 s 和 t 的等价条件是：
  - 一致性条件：状态 s 和 t 必须同时为可接受状态或不接受状态。
  - 蔓延性条件：对于所有输入符号，状态 s 和 t 必须转换到等价的状态里。

对于所有输入符号 c，Ic(s) = Ic(t)，即状态 s、t 对于 c 具有相同的后继，则称 s，t 是等价的。

（任何有后继的状态和任何无后继的状态一定不等价！）

### 正则文法、正则表达式、有限自动机相互转换

![图片](https://uploader.shimo.im/f/km3zi406ICRWhKqP.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

## 第四章 语法分析

### 主要内容

![图片](https://uploader.shimo.im/f/HfBaofCP1JIYza19.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

- 语法分析大的分为自上而下分析和自下而上分析两大类；
- 通过自上而下分析方法的介绍，引入了消除左递归和消除回溯的算法；
- 通过递归下降分析法的介绍，引入了求 FIRST 集和求 FOLLOW 集、构造递归下降分析表和递归下降子程序框图的算法；
- 通过 LL(1)文法的介绍，引入了 LL(1)分析器的构造、LL(1)分析表的构造以及采用 LL(1)进行语法分析程序的算法。
- 通过对自下而上分析方法的介绍引入了语法分析的一般方法；
- 通过对简单优先分析法概念的介绍，说明了求简单优先矩阵和用简单优先分析法进行语法分析的算法；
- 通过对算符优先文法的介绍，引入了素短语的概念，并介绍了构造算符优先矩阵和用算符优先矩阵进行语法分析的算法；
- 通过 LR 分析法的介绍，引入了规范句型活前缀、项目、有效项目集族等概念，并说明了构造 LR 分析器、构造有效项目族的算法。

### 学习要求

- 了解语法分析的概念、各种分析方法的分析表的构造、各种分析方法进行语法分析的算法；
- 了解自上而下和自下而上分析法进行语法分析的精髓；理解简单优先文法和算符优先文法的概念，掌握根据语法树求素短语、最左素短语、简单优先文法的符号比较、算符优先文法的符号比较的算法，掌握构造递归下降程序框图的算法；熟练应用消除左递归、FIRST 集、FOLLOW 集、求有效项目、有效项目集族的算法。

### 重点、难点

各下推自动机的工作原理，及其中分析表的构造。

## 第五章 语法制导的翻译

![图片](https://uploader.shimo.im/f/kuF2j6nLXeTS6F9T.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

## 第六章 符号表管理

### 主要内容

- 非分程序结构语言的符号表组织
- 分程序结构语言的符号表组织

在符号表上最常执行的操作是插表（登录符号表）和查表（或检索），这些操作根据所编译的语言是否具有显示声明而稍有不同。遇到声明语句或定义语句时先查表再插表。

符号表的使用将贯穿编译整个过程，但不存在于运行时期。

### 学习要求

- 了解非分程序结构语言和分程序结构语言的符号表组织方式，重点理解分程序结构程序栈式符号表。
- 要求给出一个程序，能够分析程序运行到不同节点时符号栈的情况。

### 重点和难点

> 分程序结构语言的符号表组织

- 每当进入一个内层模块或调用某个函数时，在栈式符号栈的栈顶加载“当前模块或函数”的符号表；从内层模块出来或从函数调用返回时，弹出“当前模块或函数”的符号表。
- 所有简单变量、数组变量、自定义变量、函数等，在符号表中地位相同。

## 第七章 运行时的存储组织及管理

### 主要内容

- 静态存储：
  - 在**编译阶段**由**编译程序**实现对存储空间的管理，和为源程序中的变量分配存储的方法。
- 动态存储分配：
  - 在目标程序**运行阶段**由**目标程序**实现对存储空间的组织与管理，和为源程序中的变量分配存储的方法。

### 学习要求

- 了解静态存储和动态存储的区别。
- 理解活动记录的工作原理，尤其是理解 display 的作用。
- 注意，display 区是 Pascal 语言特有的组织结构，并非对所有语言都是如此。如 RISC 体系架构中 C++语言的程序运行栈。

> 尽信书则不如无书也！

### FORTRAN 子程序的典型数据区

![图片](https://uploader.shimo.im/f/Cu3KWc6HEllOpi9p.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/itgqa1RhC0pv2s1M.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

### 地址空间

![图片](https://uploader.shimo.im/f/QszrTnnRqb3dxS98.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/4LlAq53zVkDKkr0f.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/kZVsPF63lwzBQqzu.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/Rx89GGmHFvc0gw4O.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/GGE65G82EThQYRmP.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/1POHJIXRPLl4v6MQ.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/e1GKvEu5ILJJq5Ab.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

![图片](https://uploader.shimo.im/f/wi6k2Ew5Wc8ACT3M.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

## 第八章 源程序的中间形式

### 主要内容

- 波兰表示
- N-元表示（三元、**四元式**）
- 抽象机代码（专属于栈式指令集 CPU 体系架构）

### 学习要求

了解中间代码的作用，各种中间代码形式的特点和区别。理解栈式抽象机的工作原理。

## 第九章 错误处理

### 主要内容

- 错误处理程序的作用
- 如何诊察和报告语法、语义错误
- 错误处理技术

### 学习要求

了解错误处理程序的作用，掌握如何诊察和报告语法错误，了解语义错误的处理方式。

## 第十章 语义分析和中间代码生成

### 主要内容

- 语义分析的概念
- 栈式抽象机及其汇编指令
- 声明的处理数组信息向量

### 学习要求

- 了解语义分析的概念。重点是和语法分析的区别。
- 掌握数组信息向量，理解数组变量的寻址方式。

## 第十一章 中间代码优化

### 主要内容

- 与机器有关的优化和与机器无关的优化
- 局部优化、全局优化、循环优化、跨函数优化（未讲）
- 基本块
- 全局数据流分析

### 优化分类

![图片](https://uploader.shimo.im/f/36UFXlDVppMU1rWE.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

与机器有关的优化：充分利用系统资源（指令系统，寄存器资源）。

第二种优化分类方法(优化范围)：

- 局部优化技术
  - 指在**基本块内**进行的优化
  - 代数变换：常数合并，运算强度削弱(左移右移)
  - 复写传播：x:=y，x:=3（常量传播）
  - 删除局部公共子表达式——DAG 图
  - 删除冗余代码
- 全局优化技术
  - **函数/过程内**进行的优化
  - 跨越基本块
  - 例如，全局数据流分析
- 跨函数优化技术
  - 整个程序。例如，跨函数别名分析，逃逸分析等

### DAG 图

- 作用：消除局部公共子表达式
- 从 DAG 图导出中间代码的启发式算法

### 数据流分析

![图片](https://uploader.shimo.im/f/1RRRQtXnt3l0JKdt.png!thumbnail?fileGuid=pmkxQbZgoXtod4AN)

### 定义-使用链、网和冲突图

def-use 链 -> 网 -> 冲突图

### 循环优化

- 循环不变式的代码外提
- 循环展开
- 归纳变量的优化
- 条件判断的替换
- in_line 展开（函数内联）

## 第十二章 目标代码生成及优化

### 微处理器体系结构基础知识

> （4 种现代微处理器体系结构）

- 栈式
- 累加器式
- 寄存器-内存式 (CISC)
- 寄存器-寄存器式 (RISC)

关键是要理解使用内存和寄存器的区别。原则是尽可能少地访问寄存器之外的存储设备！

### 构建冲突图

- 变量冲突的基本概念
- 通过活跃变量分析构建（精度不太高的）冲突图

### 寄存器的分配和指派

- 全局寄存器分配算法
  - 引用计数
  - 图着色
- 临时寄存器池管理方法

### 指令选择

- 套用模板、窥孔优化
